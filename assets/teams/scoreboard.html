{% extends "base.html" %}
{% block stylesheets %}
{{ Assets.css("assets/scss/main.scss") }}
{% endblock %}
{% block content %}
<div class="jumbotron">
	<div class="container">
		<h1>Scoreboard</h1>
	</div>
</div>
<div class="container scoreboardTab" x-data="ScoreboardList">
	{% if errors %}
	<div id='errors' class="row">
		<div class="col-md-12">
		{% for error in errors %}
			<h1 class="text-center">{{ error }}</h1>
		{% endfor %}
		</div>
	</div>
	{% else %}
	    {% if score_frozen %}
	    <div class="row">
			<div class="col-md-12">
				<h1 class="text-center">Scoreboard has been frozen.</h1>
			</div>
		</div>
	    {% endif %}

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="tab-overall" data-toggle="tab" href="#overall" role="tab" aria-controls="overall" aria-selected="true" @click="activeBracket = null">Overall</a>
        </li>
        {% for category in categories %}
        <li class="nav-item">
            <a class="nav-link" id="tab-{{ category }}" data-toggle="tab" href="#{{ category }}" role="tab" aria-controls="{{ category }}" aria-selected="false" @click="activeBracket = '{{ category }}'">{{ category }}</a>
        </li>
        {% endfor %}
    </ul>
    <div id="score-graph" class="align-items-center" x-data="ScoreboardDetail" x-ref="scoregraph" @bracket-change.window="activeBracket=$event.detail; update();">
        <div class="col-md-12 text-center">
            <i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
        </div>
    </div>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="overall" role="tabpanel" aria-labelledby="tab-overall">
            <h2 class="text-center scoreboardName">Overall Scoreboard</h2>
		{% if standings %}
			<div id="scoreboard-overall" class="col-md-12">
				<table class="table table-striped">
					<thead>
						<tr>
							<td scope="col" width="10px"><b>Place</b></td>
							<td scope="col"><b>Team</b></td>
							<td scope="col"><b>Score</b></td>
						</tr>
					</thead>
					<tbody>
					{% for standing in standings %}
						<tr>
							<th scope="row" class="text-center">{{ loop.index }}</th>
							<td>
								<a href="{{ generate_account_url(standing.account_id) }}">
									{{ standing.name | truncate(50) }}

									{% if standing.oauth_id %}
										{% if get_config('user_mode') == 'teams' %}
										<a href="https://majorleaguecyber.org/t/{{ standing.name }}">
											<span class="badge badge-primary">Official</span>
										</a>
										{% elif get_config('user_mode') == 'users' %}
										<a href="https://majorleaguecyber.org/u/{{ standing.name }}">
											<span class="badge badge-primary">Official</span>
										</a>
										{% endif %}
									{% endif %}
								</a>
							</td>
							<td>{{ standing.score }}</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
        </div>

        {% for category in categories %}
        <div class="tab-pane fade" id="{{ category }}" role="tabpanel" aria-labelledby="tab-{{ category }}">
            <h2 class="text-center scoreboardName">{{ category }} Scoreboard</h2>
		{% if standings_by_category[category] %}
			<div id="scoreboard-{{ category }}" class="col-md-12">
				<table class="table table-striped">
					<thead>
						<tr>
							<td scope="col" width="10px"><b>Place</b></td>
							<td scope="col"><b>Team</b></td>
							<td scope="col"><b>Score</b></td>
						</tr>
					</thead>
					<tbody>
					{% for standing in standings_by_category[category] %}
						<tr>
							<th scope="row" class="text-center">{{ loop.index }}</th>
							<td>
								<a href="{{ generate_account_url(standing.account_id) }}">
									{{ standing.name | truncate(50) }}

									{% if standing.oauth_id %}
										{% if get_config('user_mode') == 'teams' %}
										<a href="https://majorleaguecyber.org/t/{{ standing.name }}">
											<span class="badge badge-primary">Official</span>
										</a>
										{% elif get_config('user_mode') == 'users' %}
										<a href="https://majorleaguecyber.org/u/{{ standing.name }}">
											<span class="badge badge-primary">Official</span>
										</a>
										{% endif %}
									{% endif %}
								</a>
							</td>
							<td>{{ standing.score }}</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
        </div>
        {% endfor %}
        </div>
	{% endif %}
</div>
{% endblock %}

{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  {{ Assets.js("assets/js/scoreboard.js") }}
{% endblock %}